const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LandingView-D_YhQH63.js","assets/ThemeToggle-BReX7kX9.js","assets/vue-vendor-BcXXBMiL.js","assets/vendor-BurblMQO.js","assets/ThemeToggle-BLLHl9nT.css","assets/element-plus-CnTH0YLU.js","assets/element-plus-nq7etrhL.css","assets/LandingView-Bp9Fr6m8.css","assets/DocsView-yuhvQ80P.js","assets/DocsView-D7_afKl-.css","assets/LoginView-BAlXktQZ.js","assets/LoginView-tn0RQdqM.css","assets/UserLoginView-96fXNzjL.js","assets/UserLoginSocialView-Byik1iwH.js","assets/UserLoginSocialView-C4Hp7Zxt.css","assets/SSOCallbackView-DFOcEih4.js","assets/SSOCallbackView-BmSwEj0g.css","assets/UserDashboardView-CHuOf1fh.js","assets/ConfirmModal-CpUxvFdP.js","assets/ConfirmModal-BvCtxUSJ.css","assets/TutorialView-CzSKe5uD.js","assets/TutorialView-BFkOWxdf.css","assets/UserManagementView-BKpNSLHe.js","assets/MainLayout-8TlwH-Yd.js","assets/LogoTitle-Cda7Wa-0.js","assets/LogoTitle-DXipqypn.css","assets/MainLayout-CCQ2LruH.css","assets/DashboardView-m-9Uu9hD.js","assets/chart-CK_7ZqFC.js","assets/DashboardView-Bi25pTix.css","assets/ApiKeysView-BOGUVs-u.js","assets/WindowCountdown-Zt4Hv-eG.js","assets/CustomDropdown-DfWsRSuG.js","assets/CustomDropdown-jjrvIxsf.css","assets/ApiKeysView-D1WFQ8JQ.css","assets/AccountsView-C-B5uOZu.js","assets/AccountsView-B-QgOtlU.css","assets/SettingsView-CYDwwDXn.js","assets/SettingsView-D_bHGGPe.css","assets/ApiStatsView-DcqQ6mDV.js","assets/ApiStatsView-B0f5oL2D.css"])))=>i.map(i=>d[i]);
import{aP as G,r as f,c as E,a8 as b,aQ as _e,aR as ye,o as N,aS as we,aT as Ae,q as Q,V as oe,I as ae,z as v,x as P,ac as Te,Q as Se,a5 as ne,y as S,C as F,L as H,P as L,Y as ie,B as be,R as K,J as Ie,T as Ee,O as Pe,av as Ce,aM as xe,aU as Oe,aV as Le}from"./vue-vendor-BcXXBMiL.js";import{E as Ue,a as C,i as Re,z as Ne}from"./element-plus-CnTH0YLU.js";import{_ as A}from"./vendor-BurblMQO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const Ve="modulepreload",$e=function(e){return"/"+e},re={},_=function(t,r,o){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(r.map(m=>{if(m=$e(m),m in re)return;re[m]=!0;const h=m.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${p}`))return;const i=document.createElement("link");if(i.rel=h?"stylesheet":Ve,h||(i.as="script"),i.crossOrigin="",i.href=m,c&&i.setAttribute("nonce",c),document.head.appendChild(i),h)return new Promise((u,g)=>{i.addEventListener("load",u),i.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&n(c.reason);return t().catch(n)})};let x=null,De=0;function le(e,t="info",r="",o=3e3){x||(x=document.createElement("div"),x.id="toast-container",x.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 10000;",document.body.appendChild(x));const s=++De,n=document.createElement("div");n.className=`toast rounded-2xl p-4 shadow-2xl backdrop-blur-sm toast-${t}`,n.style.cssText=`
    position: relative;
    min-width: 320px;
    max-width: 500px;
    margin-bottom: 16px;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
  `;const a={success:"fas fa-check-circle",error:"fas fa-times-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"},c=e.replace(/\n/g,"<br>");return n.innerHTML=`
    <div class="flex items-start gap-3">
      <div class="flex-shrink-0 mt-0.5">
        <i class="${a[t]} text-lg"></i>
      </div>
      <div class="flex-1 min-w-0">
        ${r?`<h4 class="font-semibold text-sm mb-1">${r}</h4>`:""}
        <p class="text-sm opacity-90 leading-relaxed">${c}</p>
      </div>
      <button onclick="this.parentElement.parentElement.remove()" 
              class="flex-shrink-0 text-white/70 hover:text-white transition-colors ml-2">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `,x.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},10),o>0&&setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.remove()},300)},o),s}const qe=Object.freeze(Object.defineProperty({__proto__:null,showToast:le},Symbol.toStringTag,{value:"Module"})),X={basePath:"/",apiPrefix:""};function Me(e=""){return e&&!e.startsWith("/")&&(e="/"+e),X.basePath+(e.startsWith("#")?e:"#"+e)}function Ke(){return Me("/login")}const Y=X.apiPrefix;function U(e){return e.startsWith("/")||(e="/"+e),Y+e}class He{constructor(){this.baseURL=Y}getAuthToken(){return localStorage.getItem("authToken")||null}buildConfig(t={}){const r={headers:{"Content-Type":"application/json",...t.headers},...t},o=this.getAuthToken();return o&&(r.headers.Authorization=`Bearer ${o}`),r}async handleResponse(t){if(t.status===401){const o=window.location.pathname+window.location.hash;throw o.includes("/login")||o.endsWith("/")||(localStorage.removeItem("authToken"),window.location.href=Ke()),new Error("Unauthorized")}const r=t.headers.get("content-type");if(r&&r.includes("application/json")){const o=await t.json();if(!t.ok){const s=new Error(o.message||`HTTP ${t.status}`);throw s.response={status:t.status,data:o},s.message=o.message||s.message,s}return o}if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return t}async get(t,r={}){let o=U(t);if(r.params){const c=new URLSearchParams(r.params);o+="?"+c.toString()}const{params:s,...n}=r,a=this.buildConfig({...n,method:"GET"});try{const c=await fetch(o,a);return await this.handleResponse(c)}catch(c){throw console.error("API GET Error:",c),c}}async post(t,r=null,o={}){const s=U(t),n=this.buildConfig({...o,method:"POST",body:r?JSON.stringify(r):void 0});try{const a=await fetch(s,n);return await this.handleResponse(a)}catch(a){throw console.error("API POST Error:",a),a}}async put(t,r=null,o={}){const s=U(t),n=this.buildConfig({...o,method:"PUT",body:r?JSON.stringify(r):void 0});try{const a=await fetch(s,n);return await this.handleResponse(a)}catch(a){throw console.error("API PUT Error:",a),a}}async patch(t,r=null,o={}){const s=U(t),n=this.buildConfig({...o,method:"PATCH",body:r?JSON.stringify(r):void 0});try{const a=await fetch(s,n);return await this.handleResponse(a)}catch(a){throw console.error("API PATCH Error:",a),a}}async delete(t,r={}){const o=U(t),{data:s,...n}=r,a=this.buildConfig({...n,method:"DELETE",body:s?JSON.stringify(s):void 0});try{const c=await fetch(o,a);return await this.handleResponse(c)}catch(c){throw console.error("API DELETE Error:",c),c}}}const q=new He,I=`${Y}/users`,z=G("user",{state:()=>({user:null,isAuthenticated:!1,sessionToken:null,loading:!1,config:null,authProvider:"local",clerkIntegration:{isEnabled:!1,clerkUserId:null,oauthProvider:null}}),getters:{isLoggedIn:e=>e.isAuthenticated&&e.user,userName:e=>{var t,r;return((t=e.user)==null?void 0:t.displayName)||((r=e.user)==null?void 0:r.username)},userRole:e=>{var t;return(t=e.user)==null?void 0:t.role},isClerkUser:e=>e.authProvider==="clerk",isLocalUser:e=>e.authProvider==="local"||e.authProvider==="ldap",authProviderDisplay:e=>({local:"本地账户",ldap:"LDAP账户",clerk:"Clerk社交账户"})[e.authProvider]||"未知",oauthProviderDisplay:e=>e.clerkIntegration.oauthProvider?{google:"Google",github:"GitHub"}[e.clerkIntegration.oauthProvider]||e.clerkIntegration.oauthProvider:null},actions:{async login(e){this.loading=!0;try{const t=await A.post(`${I}/login`,e);if(t.data.success)return this.user=t.data.user,this.sessionToken=t.data.sessionToken,this.isAuthenticated=!0,localStorage.setItem("userToken",this.sessionToken),localStorage.setItem("userData",JSON.stringify(this.user)),this.setAuthHeader(),t.data;throw new Error(t.data.message||"Login failed")}catch(t){throw this.clearAuth(),t}finally{this.loading=!1}},async logout(){try{this.sessionToken&&await A.post(`${I}/logout`,{},{headers:{"x-user-token":this.sessionToken}})}catch(e){console.error("Logout request failed:",e)}finally{this.clearAuth()}},async checkAuth(){const e=localStorage.getItem("userToken"),t=localStorage.getItem("userData"),r=localStorage.getItem("userConfig"),o=localStorage.getItem("authProvider")||"local",s=localStorage.getItem("clerkIntegration");if(!e||!t)return this.clearAuth(),!1;try{return this.sessionToken=e,this.user=JSON.parse(t),this.config=r?JSON.parse(r):null,this.authProvider=o,this.isAuthenticated=!0,s&&o==="clerk"&&(this.clerkIntegration=JSON.parse(s)),this.setAuthHeader(),await this.getUserProfile(),!0}catch(n){return console.error("Auth check failed:",n),this.clearAuth(),!1}},async getUserProfile(){var e,t,r,o;try{const s=await A.get(`${I}/profile`);if(s.data.success)return this.user=s.data.user,this.config=s.data.config,localStorage.setItem("userData",JSON.stringify(this.user)),localStorage.setItem("userConfig",JSON.stringify(this.config)),s.data.user}catch(s){throw(((e=s.response)==null?void 0:e.status)===401||((t=s.response)==null?void 0:t.status)===403)&&(this.clearAuth(),((r=s.response)==null?void 0:r.status)===403)?new Error(((o=s.response.data)==null?void 0:o.message)||"Your account has been disabled"):s}},async getUserApiKeys(e=!1){try{const t={};e&&(t.includeDeleted="true");const r=await A.get(`${I}/api-keys`,{params:t});return r.data.success?r.data.apiKeys:[]}catch(t){throw console.error("Failed to fetch API keys:",t),t}},async createApiKey(e){try{return(await A.post(`${I}/api-keys`,e)).data}catch(t){throw console.error("Failed to create API key:",t),t}},async deleteApiKey(e){try{return(await A.delete(`${I}/api-keys/${e}`)).data}catch(t){throw console.error("Failed to delete API key:",t),t}},async getUserUsageStats(e={}){try{const t=await A.get(`${I}/usage-stats`,{params:e});return t.data.success?t.data.stats:null}catch(t){throw console.error("Failed to fetch usage stats:",t),t}},async setUserData(e){try{return this.user=e,this.sessionToken=e.sessionToken,this.isAuthenticated=!0,this.authProvider=e.authProvider||"clerk",e.authProvider==="clerk"&&(this.clerkIntegration={isEnabled:!0,clerkUserId:e.clerkUserId,oauthProvider:e.provider}),localStorage.setItem("userToken",this.sessionToken),localStorage.setItem("userData",JSON.stringify(this.user)),localStorage.setItem("authProvider",this.authProvider),this.clerkIntegration.isEnabled&&localStorage.setItem("clerkIntegration",JSON.stringify(this.clerkIntegration)),this.setAuthHeader(),!0}catch(t){throw console.error("设置用户数据失败:",t),t}},async loginWithClerk(e){this.loading=!0;try{const t={provider:"clerk",clerkUserId:e.clerkUserId,email:e.email,firstName:e.firstName,lastName:e.lastName,fullName:e.fullName,avatar:e.avatar,oauthProvider:e.provider,clerkToken:e.clerkToken},r=await A.post(`${I}/clerk/auth`,t);if(r.data.success)return await this.setUserData({...r.data.user,authProvider:"clerk",sessionToken:r.data.sessionToken,clerkUserId:e.clerkUserId,provider:e.provider}),r.data;throw new Error(r.data.message||"Clerk 登录失败")}catch(t){throw this.clearAuth(),t}finally{this.loading=!1}},clearAuth(){this.user=null,this.sessionToken=null,this.isAuthenticated=!1,this.config=null,this.authProvider="local",this.clerkIntegration={isEnabled:!1,clerkUserId:null,oauthProvider:null},localStorage.removeItem("userToken"),localStorage.removeItem("userData"),localStorage.removeItem("userConfig"),localStorage.removeItem("authProvider"),localStorage.removeItem("clerkIntegration"),delete A.defaults.headers.common["x-user-token"]},setAuthHeader(){this.sessionToken&&(A.defaults.headers.common["x-user-token"]=this.sessionToken)},setupAxiosInterceptors(){A.interceptors.response.use(e=>e,e=>{var t,r;if(((t=e.response)==null?void 0:t.status)===403){const o=(r=e.response.data)==null?void 0:r.message;o&&(o.includes("disabled")||o.includes("Account disabled"))&&(this.clearAuth(),le(o,"error"),window.location.pathname!=="/user-login"&&(window.location.href="/user-login"))}return Promise.reject(e)})}}}),M={publishableKey:void 0,localization:{locale:"zh-CN"},appearance:{baseTheme:"modern",variables:{colorPrimary:"#1677ff",colorSuccess:"#67c23a",colorWarning:"#e6a23c",colorDanger:"#f56c6c",colorInfo:"#909399",fontFamily:'"Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif',fontSize:"14px",borderRadius:"4px",spacingUnit:"8px"},elements:{formButtonPrimary:{fontSize:"14px",padding:"12px 20px",borderRadius:"4px"},formFieldInput:{borderRadius:"4px",fontSize:"14px"},socialButtonsBlockButton:{borderRadius:"4px",fontSize:"14px",padding:"12px 20px"},card:{borderRadius:"8px",boxShadow:"0 2px 12px 0 rgba(0, 0, 0, 0.1)"}}},routing:{afterSignInUrl:"/user-dashboard",afterSignUpUrl:"/user-dashboard",signInUrl:"/user-login-social",signUpUrl:"/user-login-social"}},R={google:{name:"Google",displayName:"谷歌账号",icon:"google",buttonText:"使用 Google 账号登录"}},se={clerk_error_generic:"登录过程中出现错误，请重试",clerk_error_network:"网络连接错误，请检查网络后重试",clerk_error_oauth_cancelled:"用户取消了授权登录",clerk_error_oauth_failed:"OAuth 授权失败，请重试",clerk_error_session_expired:"登录会话已过期，请重新登录",clerk_error_user_not_found:"用户不存在",clerk_error_invalid_token:"无效的认证令牌"};function ze(){return console.warn("Clerk: 缺少 VITE_CLERK_PUBLISHABLE_KEY 环境变量"),!1}const Be=G("clerk",()=>{const e=f(!1),t=f(!0),r=f(!1),o=f(!1),s=f(!1),n=f(null),a=f(null),c=f(null),m=f(Object.keys(R)),h=f(null),p=f(null),i=f(0);let u=null,g=null;function T(){try{if(console.log("Clerk Store: 开始初始化"),u=_e(),g=ye(),console.log("Clerk Store: 实例获取结果",{hasClerkInstance:!!u,hasUserInstance:!!g,clerkLoaded:u==null?void 0:u.loaded}),u&&g)u.loaded?(e.value=!0,t.value=!1,ee(),console.log("Clerk Store: 成功初始化（已加载）")):(console.log("Clerk Store: 等待 Clerk 加载完成..."),u.addOnLoaded(()=>{e.value=!0,t.value=!1,ee(),console.log("Clerk Store: 成功初始化（加载完成）")}));else throw new Error("无法获取 Clerk 实例")}catch(l){console.error("Clerk Store: 初始化失败",l),e.value=!1,t.value=!1}}const d=E(()=>{var l;return n.value?{id:n.value.id,email:(l=n.value.primaryEmailAddress)==null?void 0:l.emailAddress,firstName:n.value.firstName,lastName:n.value.lastName,fullName:`${n.value.firstName||""} ${n.value.lastName||""}`.trim(),avatar:n.value.imageUrl,provider:ge(n.value),createdAt:n.value.createdAt,lastActiveAt:n.value.lastActiveAt}:null}),k=E(()=>r.value&&a.value&&c.value),W=E(()=>!h.value||!R[h.value]?null:R[h.value]);function ee(){N(()=>g==null?void 0:g.user,l=>{n.value=l,r.value=!!l,l?(me(),j()):te()},{immediate:!0}),N(()=>u==null?void 0:u.session,l=>{a.value=l,l&&J()},{immediate:!0})}async function ue(l="google",w={}){if(!e.value)throw new Error("Clerk 尚未初始化完成");if(!R[l])throw new Error(`不支持的 OAuth 提供商: ${l}`);o.value=!0,h.value=l,p.value=null;const $=Ue.service({lock:!0,text:`正在使用 ${R[l].displayName} 登录...`,spinner:"el-icon-loading"});try{await u.authenticateWithRedirect({strategy:`oauth_${l}`,redirectUrl:w.redirectUrl||"/sso-callback",redirectUrlComplete:w.afterSignInUrl||"/user-dashboard"}),console.log(`Clerk Store: 开始 ${l} OAuth 登录流程`)}catch(D){console.error(`Clerk Store: ${l} 登录失败`,D),o.value=!1,h.value=null,p.value=D,i.value++;const ke=pe(D);throw C.error(ke),D}finally{$.close()}}async function de(){if(!e.value)throw new Error("Clerk 尚未初始化完成");try{if(await new Promise(l=>{const w=N(()=>r.value,$=>{$&&(w(),l())});setTimeout(()=>{w(),l()},1e4)}),r.value)return console.log("Clerk Store: OAuth 回调处理成功"),await j(),!0;throw new Error("OAuth 回调处理超时")}catch(l){throw console.error("Clerk Store: OAuth 回调处理失败",l),p.value=l,l}}async function he(){if(!(!e.value||!r.value)){s.value=!0;try{await u.signOut(),te(),await z().logout(),C.success("已成功退出登录"),console.log("Clerk Store: 用户已成功登出")}catch(l){throw console.error("Clerk Store: 登出失败",l),C.error("登出时发生错误"),l}finally{s.value=!1}}}async function j(){if(!d.value){console.warn("Clerk Store: 无用户数据需要同步");return}try{if(await J(),!c.value)throw new Error("无法获取 Clerk 认证 Token");const l={clerkUserId:d.value.id,email:d.value.email,firstName:d.value.firstName,lastName:d.value.lastName,fullName:d.value.fullName,avatar:d.value.avatar,provider:d.value.provider,clerkToken:c.value},w=await A.post("/webapi/users/clerk/sync",l);if(w.data.success)await z().setUserData({...w.data.user,authProvider:"clerk",sessionToken:w.data.sessionToken}),console.log("Clerk Store: 用户数据同步成功"),C.success("登录成功，欢迎回来！");else throw new Error(w.data.message||"用户数据同步失败")}catch(l){throw console.error("Clerk Store: 用户数据同步失败",l),l.code==="NETWORK_ERROR"?C.error("网络连接错误，请稍后重试"):C.error("用户数据同步失败，请联系管理员"),l}}async function fe(){if(!r.value||!a.value)return null;try{return await a.value.getToken()}catch(l){return console.error("Clerk Store: 获取 Token 失败",l),null}}async function me(){try{a.value=(u==null?void 0:u.session)||null,await J()}catch(l){console.error("Clerk Store: 更新会话信息失败",l)}}async function J(){try{a.value&&(c.value=await a.value.getToken())}catch(l){console.error("Clerk Store: 更新 Token 失败",l),c.value=null}}function te(){r.value=!1,n.value=null,a.value=null,c.value=null,h.value=null}function ge(l){return!l||!l.externalAccounts||l.externalAccounts.length===0?"email":l.externalAccounts[0].provider||"unknown"}function pe(l){const w=(l==null?void 0:l.code)||(l==null?void 0:l.type)||"clerk_error_generic";return se[w]||se.clerk_error_generic}function ve(){p.value=null}return{isClerkReady:b(e),isClerkLoading:b(t),isAuthenticated:b(r),isSigningIn:b(o),isSigningOut:b(s),currentUser:d,hasValidSession:k,authProviderInfo:W,availableProviders:b(m),lastError:b(p),errorCount:b(i),initializeClerk:T,signInWithProvider:ue,handleOAuthCallback:de,signOut:he,syncWithUserStore:j,getClerkToken:fe,clearError:ve}}),Ge=()=>_(()=>import("./LandingView-D_YhQH63.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),We=()=>_(()=>import("./DocsView-yuhvQ80P.js"),__vite__mapDeps([8,1,2,3,4,5,6,9])),je=()=>_(()=>import("./LoginView-BAlXktQZ.js"),__vite__mapDeps([10,2,3,1,4,5,6,11])),Je=()=>_(()=>import("./UserLoginView-96fXNzjL.js"),__vite__mapDeps([12,2,3,1,4,5,6,11])),Fe=()=>_(()=>import("./UserLoginSocialView-Byik1iwH.js"),__vite__mapDeps([13,2,3,1,4,5,6,14])),Qe=()=>_(()=>import("./SSOCallbackView-DFOcEih4.js"),__vite__mapDeps([15,2,3,1,4,5,6,16])),Xe=()=>_(()=>import("./UserDashboardView-CHuOf1fh.js"),__vite__mapDeps([17,2,3,1,4,18,19,20,5,6,21,11])),Ye=()=>_(()=>import("./UserManagementView-BKpNSLHe.js"),__vite__mapDeps([22,2,3,18,19,5,6,11])),O=()=>_(()=>import("./MainLayout-8TlwH-Yd.js"),__vite__mapDeps([23,2,3,24,25,1,4,5,6,26])),Ze=()=>_(()=>import("./DashboardView-m-9Uu9hD.js"),__vite__mapDeps([27,5,2,3,6,28,29])),et=()=>_(()=>import("./ApiKeysView-BOGUVs-u.js"),__vite__mapDeps([30,5,2,3,6,31,32,33,34])),tt=()=>_(()=>import("./AccountsView-C-B5uOZu.js"),__vite__mapDeps([35,5,2,3,6,18,19,28,32,33,36])),rt=()=>_(()=>import("./TutorialView-CzSKe5uD.js"),__vite__mapDeps([20,2,3,5,6,21])),st=()=>_(()=>import("./SettingsView-CYDwwDXn.js"),__vite__mapDeps([37,2,3,5,6,38])),ot=()=>_(()=>import("./ApiStatsView-DcqQ6mDV.js"),__vite__mapDeps([39,2,3,24,25,1,4,31,20,5,6,21,40])),at=[{path:"/",name:"Landing",component:Ge,meta:{requiresAuth:!1}},{path:"/login",name:"Login",component:je,meta:{requiresAuth:!1}},{path:"/admin-login",redirect:"/login"},{path:"/user-login",name:"UserLogin",component:Je,meta:{requiresAuth:!1,userAuth:!0}},{path:"/user-login-social",name:"UserLoginSocial",component:Fe,meta:{requiresAuth:!1,clerkAuth:!0}},{path:"/sso-callback",name:"SSOCallback",component:Qe,meta:{requiresAuth:!1,ssoCallback:!0}},{path:"/user-dashboard",name:"UserDashboard",component:Xe,meta:{requiresUserAuth:!0}},{path:"/docs",name:"Docs",component:We,meta:{requiresAuth:!1}},{path:"/api-stats",name:"ApiStats",component:ot,meta:{requiresAuth:!1}},{path:"/dashboard",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:Ze}]},{path:"/api-keys",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"ApiKeys",component:et}]},{path:"/accounts",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"Accounts",component:tt}]},{path:"/tutorial",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"Tutorial",component:rt}]},{path:"/settings",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"Settings",component:st}]},{path:"/user-management",component:O,meta:{requiresAuth:!0},children:[{path:"",name:"UserManagement",component:Ye}]},{path:"/:pathMatch(.*)*",redirect:"/"}],B=we({history:Ae(X.basePath),routes:at});B.beforeEach(async(e,t,r)=>{const o=ce(),s=z(),n=Be();if(console.log("路由导航:",{to:e.path,from:t.path,fullPath:e.fullPath,requiresAuth:e.meta.requiresAuth,requiresUserAuth:e.meta.requiresUserAuth,clerkAuth:e.meta.clerkAuth,ssoCallback:e.meta.ssoCallback,isAuthenticated:o.isAuthenticated,isUserAuthenticated:s.isAuthenticated,isClerkAuthenticated:n.isAuthenticated}),e.path===t.path&&e.fullPath===t.fullPath||e.meta.ssoCallback)return r();if(e.meta.requiresUserAuth){if(!s.isAuthenticated)try{if(!await s.checkAuth())return r("/user-login")}catch(a){if(a.message&&a.message.includes("disabled")){const{showToast:c}=await _(async()=>{const{showToast:m}=await Promise.resolve().then(()=>qe);return{showToast:m}},void 0);c(a.message,"error")}return r("/user-login")}return r()}e.path==="/"||e.path==="/docs"||e.path==="/api-stats"||e.path.startsWith("/api-stats")?r():e.path==="/user-login"?s.isAuthenticated?r("/user-dashboard"):r():e.path==="/user-login-social"?s.isAuthenticated?r("/user-dashboard"):!n.isClerkReady&&!n.isClerkLoading?(console.warn("Clerk 尚未初始化，重定向到传统登录页面"),r("/user-login")):r():e.meta.requiresAuth&&!o.isAuthenticated?r("/login"):e.path==="/login"&&o.isAuthenticated?r("/dashboard"):r()});const ce=G("auth",()=>{const e=f(!1),t=f(localStorage.getItem("authToken")||""),r=f(""),o=f(""),s=f(!1),n=f({siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",faviconData:""}),a=f(!0),c=E(()=>!!t.value&&e.value),m=E(()=>t.value),h=E(()=>({username:r.value}));async function p(d){s.value=!0,o.value="";try{const k=await q.post("/web/auth/login",d);k.success?(t.value=k.token,r.value=k.username||d.username,e.value=!0,localStorage.setItem("authToken",k.token),await B.push("/dashboard")):o.value=k.message||"登录失败"}catch(k){o.value=k.message||"登录失败，请检查用户名和密码"}finally{s.value=!1}}function i(){e.value=!1,t.value="",r.value="",localStorage.removeItem("authToken"),B.push("/login")}function u(){t.value&&(e.value=!0,g())}async function g(){try{const d=await q.get("/web/auth/user");d.success&&d.user&&(r.value=d.user.username),(await q.get("/admin/dashboard")).success||i()}catch{i()}}async function T(){a.value=!0;try{const d=await q.get("/admin/oem-settings");if(d.success&&d.data){if(n.value={...n.value,...d.data},d.data.siteIconData||d.data.siteIcon){const k=document.querySelector("link[rel*='icon']")||document.createElement("link");k.type="image/x-icon",k.rel="shortcut icon",k.href=d.data.siteIconData||d.data.siteIcon,document.getElementsByTagName("head")[0].appendChild(k)}d.data.siteName&&(document.title=`${d.data.siteName} - 管理后台`)}}catch(d){console.error("加载OEM设置失败:",d)}finally{a.value=!1}}return{isLoggedIn:e,authToken:t,username:r,loginError:o,loginLoading:s,oemSettings:n,oemLoading:a,isAuthenticated:c,token:m,user:h,login:p,logout:i,checkAuth:u,loadOemSettings:T}}),y={LIGHT:"light",DARK:"dark",AUTO:"auto"},nt=G("theme",()=>{const e=f(y.AUTO),t=f(!1),r=E(()=>e.value===y.DARK?!0:e.value===y.LIGHT?!1:t.value),o=E(()=>r.value?y.DARK:y.LIGHT),s=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)");t.value=i.matches;const u=localStorage.getItem("themeMode");u&&Object.values(y).includes(u)?e.value=u:e.value=y.AUTO,n(),m()},n=()=>{const i=document.documentElement;r.value?i.classList.add("dark"):i.classList.remove("dark")},a=i=>{Object.values(y).includes(i)&&(e.value=i)},c=()=>{const i=[y.LIGHT,y.DARK,y.AUTO],g=(i.indexOf(e.value)+1)%i.length;e.value=i[g]};N(e,i=>{localStorage.setItem("themeMode",i),n()}),N(t,()=>{e.value===y.AUTO&&n()});const m=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)"),u=g=>{t.value=g.matches};return t.value=i.matches,i.addEventListener("change",u),()=>{i.removeEventListener("change",u)}};return{themeMode:e,isDarkMode:r,currentTheme:o,systemPrefersDark:t,ThemeMode:y,initTheme:s,setThemeMode:a,cycleThemeMode:c,watchSystemTheme:m,toggleTheme:()=>{c()},setTheme:i=>{i==="dark"?a(y.DARK):i==="light"&&a(y.LIGHT)}}}),Z=(e,t)=>{const r=e.__vccOpts||e;for(const[o,s]of t)r[o]=s;return r},it={class:"toast-container"},lt=["onClick"],ct={class:"toast-content"},ut={class:"toast-icon"},dt={class:"toast-body"},ht={key:0,class:"toast-title"},ft={class:"toast-message"},mt=["onClick"],gt={__name:"ToastNotification",setup(e,{expose:t}){const r=f([]);let o=0;const s=h=>{const p={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return p[h]||p.info},n=(h,p="info",i=null,u=5e3)=>{const g=++o,T={id:g,message:h,type:p,title:i,duration:u,isVisible:!1};return r.value.push(T),setTimeout(()=>{T.isVisible=!0},10),u>0&&setTimeout(()=>{a(g)},u),g},a=h=>{const p=r.value.findIndex(i=>i.id===h);if(p>-1){const i=r.value[p];i.isVisible=!1,setTimeout(()=>{const u=r.value.findIndex(g=>g.id===h);u>-1&&r.value.splice(u,1)},300)}},c=()=>{r.value.forEach(h=>{h.isVisible=!1}),setTimeout(()=>{r.value.length=0},300)},m=(h,p="info",i=null,u=5e3)=>n(h,p,i,u);return Q(()=>{window.showToast=m}),oe(()=>{window.showToast===m&&delete window.showToast}),t({showToast:m,removeToast:a,clearAllToasts:c}),(h,p)=>(S(),ae(ne,{to:"body"},[v("div",it,[(S(!0),P(Se,null,Te(r.value,i=>(S(),P("div",{key:i.id,class:F(["toast",`toast-${i.type}`,i.isVisible?"toast-show":"toast-hide"]),onClick:u=>a(i.id)},[v("div",ct,[v("div",ut,[v("i",{class:F(s(i.type))},null,2)]),v("div",dt,[i.title?(S(),P("div",ht,L(i.title),1)):H("",!0),v("div",ft,L(i.message),1)]),v("button",{class:"toast-close",onClick:ie(u=>a(i.id),["stop"])},p[0]||(p[0]=[v("i",{class:"fas fa-times"},null,-1)]),8,mt)]),i.duration>0?(S(),P("div",{key:0,class:"toast-progress",style:be({animationDuration:`${i.duration}ms`})},null,4)):H("",!0)],10,lt))),128))])]))}},pt=Z(gt,[["__scopeId","data-v-c8b24ff5"]]),vt={class:"modal-content mx-auto w-full max-w-md p-6"},kt={class:"mb-6 flex items-start gap-4"},_t={class:"flex-1"},yt={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-white"},wt={class:"whitespace-pre-line leading-relaxed text-gray-700 dark:text-gray-400"},At={class:"flex items-center justify-end gap-3"},Tt=["disabled"],St=["disabled"],bt={key:0,class:"loading-spinner mr-2"},It={__name:"ConfirmDialog",setup(e,{expose:t}){const r=f(!1),o=f(!1),s=f(""),n=f(""),a=f("确认"),c=f("取消");let m=null;const h=(g,T,d="确认",k="取消")=>new Promise(W=>{s.value=g,n.value=T,a.value=d,c.value=k,r.value=!0,o.value=!1,m=W}),p=()=>{o.value||(o.value=!0,setTimeout(()=>{r.value=!1,o.value=!1,m&&(m(!0),m=null)},200))},i=()=>{o.value||(r.value=!1,m&&(m(!1),m=null))},u=g=>{r.value&&(g.key==="Escape"?i():g.key==="Enter"&&!g.shiftKey&&!g.ctrlKey&&!g.altKey&&p())};return Q(()=>{window.showConfirm=h,document.addEventListener("keydown",u)}),oe(()=>{window.showConfirm===h&&delete window.showConfirm,document.removeEventListener("keydown",u)}),t({showConfirm:h}),(g,T)=>(S(),ae(ne,{to:"body"},[K(Ee,{appear:"",name:"modal"},{default:Ie(()=>[r.value?(S(),P("div",{key:0,class:"modal fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:ie(i,["self"])},[v("div",vt,[v("div",kt,[T[0]||(T[0]=v("div",{class:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-amber-600"},[v("i",{class:"fas fa-exclamation-triangle text-lg text-white"})],-1)),v("div",_t,[v("h3",yt,L(s.value),1),v("div",wt,L(n.value),1)])]),v("div",At,[v("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:o.value,onClick:i},L(c.value),9,Tt),v("button",{class:F(["btn btn-warning px-6 py-3",{"cursor-not-allowed opacity-50":o.value}]),disabled:o.value,onClick:p},[o.value?(S(),P("div",bt)):H("",!0),Pe(" "+L(a.value),1)],10,St)])])])):H("",!0)]),_:1})]))}},Et=Z(It,[["__scopeId","data-v-6b3390a6"]]),Pt={id:"app"},Ct={__name:"App",setup(e){const t=ce(),r=nt(),o=f(),s=f();return Q(()=>{r.initTheme(),r.watchSystemTheme(),t.checkAuth(),t.loadOemSettings()}),(n,a)=>{const c=Ce("router-view");return S(),P("div",Pt,[K(c),K(pt,{ref_key:"toastRef",ref:o},null,512),K(Et,{ref_key:"confirmRef",ref:s},null,512)])}}},xt=Z(Ct,[["__scopeId","data-v-dab04b7e"]]),V=xe(xt),Ot=Oe();V.use(Ot);V.use(B);V.use(Re,{locale:Ne});ze()?(V.use(Le,{publishableKey:M.publishableKey,localization:M.localization,appearance:M.appearance,routing:M.routing}),console.log("Clerk: 已成功初始化用户认证系统")):console.warn("Clerk: 配置验证失败，社交登录功能将不可用");const Lt=z();Lt.setupAxiosInterceptors();V.mount("#app");export{Z as _,ce as a,z as b,Be as c,q as d,le as s,nt as u};

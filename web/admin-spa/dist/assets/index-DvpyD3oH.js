const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LandingView-CvYwC1pl.js","assets/ThemeToggle-DDlTkMsd.js","assets/vue-vendor-K9KD2h4K.js","assets/vendor-DITxge4O.js","assets/ThemeToggle-BLLHl9nT.css","assets/element-plus-D5qhxq3g.js","assets/element-plus-nq7etrhL.css","assets/LandingView-Bp9Fr6m8.css","assets/DocsView-BQ7Lwi-K.js","assets/DocsView-D7_afKl-.css","assets/LoginView-yfkgcDte.js","assets/LoginView-tn0RQdqM.css","assets/UserLoginView-LkOuC970.js","assets/UserLoginSocialView-D4ZhnGSj.js","assets/UserLoginSocialView-C4Hp7Zxt.css","assets/SSOCallbackView-DHlwKjku.js","assets/SSOCallbackView-BmSwEj0g.css","assets/UserDashboardView-CJETLDCK.js","assets/ConfirmModal-vMpiUl8P.js","assets/ConfirmModal-BvCtxUSJ.css","assets/TutorialView-mdgdeBR0.js","assets/TutorialView-BjIHOtH3.css","assets/UserManagementView-DE6yizGJ.js","assets/MainLayout-6akrNuT5.js","assets/LogoTitle-8jh3UNwx.js","assets/LogoTitle-DXipqypn.css","assets/MainLayout-CCQ2LruH.css","assets/DashboardView-vsarS237.js","assets/chart-BDAsONZo.js","assets/DashboardView-B26ENGfc.css","assets/ApiKeysView-7cAMfAOo.js","assets/WindowCountdown-DvA-ttLU.js","assets/CustomDropdown-B3hj11Uw.js","assets/CustomDropdown-jjrvIxsf.css","assets/ApiKeysView-Ce8udzX0.css","assets/AccountsView-D66nPHej.js","assets/AccountsView-D1xD4RTD.css","assets/SettingsView-C8r1XEYu.js","assets/SettingsView-D_bHGGPe.css","assets/ApiStatsView-DoOtuaDP.js","assets/ApiStatsView-B0f5oL2D.css"])))=>i.map(i=>d[i]);
import{aP as j,r as f,c as E,a8 as S,aQ as ye,aR as ke,o as D,aS as we,aT as Ae,q as Q,V as oe,I as ae,z as v,x,ac as Te,Q as be,a5 as ne,y as b,C as J,L as H,P as O,Y as ie,B as Se,R as K,J as Ee,T as Ce,O as xe,av as Ie,aM as Pe,aU as Le,aV as Oe}from"./vue-vendor-K9KD2h4K.js";import{E as Re,a as I,i as Ue,z as De}from"./element-plus-D5qhxq3g.js";import{_ as T}from"./vendor-DITxge4O.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const Ve="modulepreload",Ne=function(t){return"/"+t},se={},y=function(e,s,o){let r=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(s.map(m=>{if(m=Ne(m),m in se)return;se[m]=!0;const h=m.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${p}`))return;const i=document.createElement("link");if(i.rel=h?"stylesheet":Ve,h||(i.as="script"),i.crossOrigin="",i.href=m,c&&i.setAttribute("nonce",c),document.head.appendChild(i),h)return new Promise((u,g)=>{i.addEventListener("load",u),i.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return r.then(a=>{for(const c of a||[])c.status==="rejected"&&n(c.reason);return e().catch(n)})};let P=null,$e=0;function le(t,e="info",s="",o=3e3){P||(P=document.createElement("div"),P.id="toast-container",P.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 10000;",document.body.appendChild(P));const r=++$e,n=document.createElement("div");n.className=`toast rounded-2xl p-4 shadow-2xl backdrop-blur-sm toast-${e}`,n.style.cssText=`
    position: relative;
    min-width: 320px;
    max-width: 500px;
    margin-bottom: 16px;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
  `;const a={success:"fas fa-check-circle",error:"fas fa-times-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"},c=t.replace(/\n/g,"<br>");return n.innerHTML=`
    <div class="flex items-start gap-3">
      <div class="flex-shrink-0 mt-0.5">
        <i class="${a[e]} text-lg"></i>
      </div>
      <div class="flex-1 min-w-0">
        ${s?`<h4 class="font-semibold text-sm mb-1">${s}</h4>`:""}
        <p class="text-sm opacity-90 leading-relaxed">${c}</p>
      </div>
      <button onclick="this.parentElement.parentElement.remove()" 
              class="flex-shrink-0 text-white/70 hover:text-white transition-colors ml-2">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `,P.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},10),o>0&&setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.remove()},300)},o),r}const qe=Object.freeze(Object.defineProperty({__proto__:null,showToast:le},Symbol.toStringTag,{value:"Module"})),X={basePath:"/",apiPrefix:""};function Me(t=""){return t&&!t.startsWith("/")&&(t="/"+t),X.basePath+(t.startsWith("#")?t:"#"+t)}function Ke(){return Me("/login")}const Y=X.apiPrefix;function R(t){return t.startsWith("/")||(t="/"+t),Y+t}class He{constructor(){this.baseURL=Y}getAuthToken(){return localStorage.getItem("authToken")||null}buildConfig(e={}){const s={headers:{"Content-Type":"application/json",...e.headers},...e},o=this.getAuthToken();return o&&(s.headers.Authorization=`Bearer ${o}`),s}async handleResponse(e){if(e.status===401){const o=window.location.pathname+window.location.hash;throw o.includes("/login")||o.endsWith("/")||(localStorage.removeItem("authToken"),window.location.href=Ke()),new Error("Unauthorized")}const s=e.headers.get("content-type");if(s&&s.includes("application/json")){const o=await e.json();if(!e.ok){const r=new Error(o.message||`HTTP ${e.status}`);throw r.response={status:e.status,data:o},r.message=o.message||r.message,r}return o}if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e}async get(e,s={}){let o=R(e);if(s.params){const c=new URLSearchParams(s.params);o+="?"+c.toString()}const{params:r,...n}=s,a=this.buildConfig({...n,method:"GET"});try{const c=await fetch(o,a);return await this.handleResponse(c)}catch(c){throw console.error("API GET Error:",c),c}}async post(e,s=null,o={}){const r=R(e),n=this.buildConfig({...o,method:"POST",body:s?JSON.stringify(s):void 0});try{const a=await fetch(r,n);return await this.handleResponse(a)}catch(a){throw console.error("API POST Error:",a),a}}async put(e,s=null,o={}){const r=R(e),n=this.buildConfig({...o,method:"PUT",body:s?JSON.stringify(s):void 0});try{const a=await fetch(r,n);return await this.handleResponse(a)}catch(a){throw console.error("API PUT Error:",a),a}}async patch(e,s=null,o={}){const r=R(e),n=this.buildConfig({...o,method:"PATCH",body:s?JSON.stringify(s):void 0});try{const a=await fetch(r,n);return await this.handleResponse(a)}catch(a){throw console.error("API PATCH Error:",a),a}}async delete(e,s={}){const o=R(e),{data:r,...n}=s,a=this.buildConfig({...n,method:"DELETE",body:r?JSON.stringify(r):void 0});try{const c=await fetch(o,a);return await this.handleResponse(c)}catch(c){throw console.error("API DELETE Error:",c),c}}}const q=new He,C=`${Y}/users`,z=j("user",{state:()=>({user:null,isAuthenticated:!1,sessionToken:null,loading:!1,config:null}),getters:{isLoggedIn:t=>t.isAuthenticated&&t.user,userName:t=>{var e,s;return((e=t.user)==null?void 0:e.displayName)||((s=t.user)==null?void 0:s.username)},userRole:t=>{var e;return(e=t.user)==null?void 0:e.role}},actions:{async login(t){this.loading=!0;try{const e=await T.post(`${C}/login`,t);if(e.data.success)return this.user=e.data.user,this.sessionToken=e.data.sessionToken,this.isAuthenticated=!0,localStorage.setItem("userToken",this.sessionToken),localStorage.setItem("userData",JSON.stringify(this.user)),this.setAuthHeader(),e.data;throw new Error(e.data.message||"Login failed")}catch(e){throw this.clearAuth(),e}finally{this.loading=!1}},async logout(){try{this.sessionToken&&await T.post(`${C}/logout`,{},{headers:{"x-user-token":this.sessionToken}})}catch(t){console.error("Logout request failed:",t)}finally{this.clearAuth()}},async checkAuth(){const t=localStorage.getItem("userToken"),e=localStorage.getItem("userData"),s=localStorage.getItem("userConfig");if(!t||!e)return this.clearAuth(),!1;try{return this.sessionToken=t,this.user=JSON.parse(e),this.config=s?JSON.parse(s):null,this.isAuthenticated=!0,this.setAuthHeader(),await this.getUserProfile(),!0}catch(o){return console.error("Auth check failed:",o),this.clearAuth(),!1}},async getUserProfile(){var t,e,s,o;try{const r=await T.get(`${C}/profile`);if(r.data.success)return this.user=r.data.user,this.config=r.data.config,localStorage.setItem("userData",JSON.stringify(this.user)),localStorage.setItem("userConfig",JSON.stringify(this.config)),r.data.user}catch(r){throw(((t=r.response)==null?void 0:t.status)===401||((e=r.response)==null?void 0:e.status)===403)&&(this.clearAuth(),((s=r.response)==null?void 0:s.status)===403)?new Error(((o=r.response.data)==null?void 0:o.message)||"Your account has been disabled"):r}},async getUserApiKeys(t=!1){try{const e={};t&&(e.includeDeleted="true");const s=await T.get(`${C}/api-keys`,{params:e});return s.data.success?s.data.apiKeys:[]}catch(e){throw console.error("Failed to fetch API keys:",e),e}},async createApiKey(t){try{return(await T.post(`${C}/api-keys`,t)).data}catch(e){throw console.error("Failed to create API key:",e),e}},async deleteApiKey(t){try{return(await T.delete(`${C}/api-keys/${t}`)).data}catch(e){throw console.error("Failed to delete API key:",e),e}},async getUserUsageStats(t={}){try{const e=await T.get(`${C}/usage-stats`,{params:t});return e.data.success?e.data.stats:null}catch(e){throw console.error("Failed to fetch usage stats:",e),e}},clearAuth(){this.user=null,this.sessionToken=null,this.isAuthenticated=!1,this.config=null,localStorage.removeItem("userToken"),localStorage.removeItem("userData"),localStorage.removeItem("userConfig"),delete T.defaults.headers.common["x-user-token"]},setAuthHeader(){this.sessionToken&&(T.defaults.headers.common["x-user-token"]=this.sessionToken)},setupAxiosInterceptors(){T.interceptors.response.use(t=>t,t=>{var e,s;if(((e=t.response)==null?void 0:e.status)===403){const o=(s=t.response.data)==null?void 0:s.message;o&&(o.includes("disabled")||o.includes("Account disabled"))&&(this.clearAuth(),le(o,"error"),window.location.pathname!=="/user-login"&&(window.location.href="/user-login"))}return Promise.reject(t)})}}}),M={publishableKey:void 0,localization:{locale:"zh-CN"},appearance:{baseTheme:"modern",variables:{colorPrimary:"#1677ff",colorSuccess:"#67c23a",colorWarning:"#e6a23c",colorDanger:"#f56c6c",colorInfo:"#909399",fontFamily:'"Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif',fontSize:"14px",borderRadius:"4px",spacingUnit:"8px"},elements:{formButtonPrimary:{fontSize:"14px",padding:"12px 20px",borderRadius:"4px"},formFieldInput:{borderRadius:"4px",fontSize:"14px"},socialButtonsBlockButton:{borderRadius:"4px",fontSize:"14px",padding:"12px 20px"},card:{borderRadius:"8px",boxShadow:"0 2px 12px 0 rgba(0, 0, 0, 0.1)"}}},routing:{afterSignInUrl:"/user-dashboard",afterSignUpUrl:"/user-dashboard",signInUrl:"/user-login-social",signUpUrl:"/user-login-social"}},U={google:{name:"Google",displayName:"谷歌账号",icon:"google",buttonText:"使用 Google 账号登录"}},re={clerk_error_generic:"登录过程中出现错误，请重试",clerk_error_network:"网络连接错误，请检查网络后重试",clerk_error_oauth_cancelled:"用户取消了授权登录",clerk_error_oauth_failed:"OAuth 授权失败，请重试",clerk_error_session_expired:"登录会话已过期，请重新登录",clerk_error_user_not_found:"用户不存在",clerk_error_invalid_token:"无效的认证令牌"};function ze(){return console.warn("Clerk: 缺少 VITE_CLERK_PUBLISHABLE_KEY 环境变量"),!1}const Be=j("clerk",()=>{const t=f(!1),e=f(!0),s=f(!1),o=f(!1),r=f(!1),n=f(null),a=f(null),c=f(null),m=f(Object.keys(U)),h=f(null),p=f(null),i=f(0);let u=null,g=null;function A(){try{if(console.log("Clerk Store: 开始初始化"),u=ye(),g=ke(),console.log("Clerk Store: 实例获取结果",{hasClerkInstance:!!u,hasUserInstance:!!g,clerkLoaded:u==null?void 0:u.loaded}),u&&g)u.loaded?(t.value=!0,e.value=!1,ee(),console.log("Clerk Store: 成功初始化（已加载）")):(console.log("Clerk Store: 等待 Clerk 加载完成..."),u.addOnLoaded(()=>{t.value=!0,e.value=!1,ee(),console.log("Clerk Store: 成功初始化（加载完成）")}));else throw new Error("无法获取 Clerk 实例")}catch(l){console.error("Clerk Store: 初始化失败",l),t.value=!1,e.value=!1}}const d=E(()=>{var l;return n.value?{id:n.value.id,email:(l=n.value.primaryEmailAddress)==null?void 0:l.emailAddress,firstName:n.value.firstName,lastName:n.value.lastName,fullName:`${n.value.firstName||""} ${n.value.lastName||""}`.trim(),avatar:n.value.imageUrl,provider:ge(n.value),createdAt:n.value.createdAt,lastActiveAt:n.value.lastActiveAt}:null}),_=E(()=>s.value&&a.value&&c.value),G=E(()=>!h.value||!U[h.value]?null:U[h.value]);function ee(){D(()=>g==null?void 0:g.user,l=>{n.value=l,s.value=!!l,l?(me(),W()):te()},{immediate:!0}),D(()=>u==null?void 0:u.session,l=>{a.value=l,l&&F()},{immediate:!0})}async function ue(l="google",w={}){if(!t.value)throw new Error("Clerk 尚未初始化完成");if(!U[l])throw new Error(`不支持的 OAuth 提供商: ${l}`);o.value=!0,h.value=l,p.value=null;const N=Re.service({lock:!0,text:`正在使用 ${U[l].displayName} 登录...`,spinner:"el-icon-loading"});try{await u.authenticateWithRedirect({strategy:`oauth_${l}`,redirectUrl:w.redirectUrl||"/sso-callback",redirectUrlComplete:w.afterSignInUrl||"/user-dashboard"}),console.log(`Clerk Store: 开始 ${l} OAuth 登录流程`)}catch($){console.error(`Clerk Store: ${l} 登录失败`,$),o.value=!1,h.value=null,p.value=$,i.value++;const _e=pe($);throw I.error(_e),$}finally{N.close()}}async function de(){if(!t.value)throw new Error("Clerk 尚未初始化完成");try{if(await new Promise(l=>{const w=D(()=>s.value,N=>{N&&(w(),l())});setTimeout(()=>{w(),l()},1e4)}),s.value)return console.log("Clerk Store: OAuth 回调处理成功"),await W(),!0;throw new Error("OAuth 回调处理超时")}catch(l){throw console.error("Clerk Store: OAuth 回调处理失败",l),p.value=l,l}}async function he(){if(!(!t.value||!s.value)){r.value=!0;try{await u.signOut(),te(),await z().logout(),I.success("已成功退出登录"),console.log("Clerk Store: 用户已成功登出")}catch(l){throw console.error("Clerk Store: 登出失败",l),I.error("登出时发生错误"),l}finally{r.value=!1}}}async function W(){if(!d.value){console.warn("Clerk Store: 无用户数据需要同步");return}try{if(await F(),!c.value)throw new Error("无法获取 Clerk 认证 Token");const l={clerkUserId:d.value.id,email:d.value.email,firstName:d.value.firstName,lastName:d.value.lastName,fullName:d.value.fullName,avatar:d.value.avatar,provider:d.value.provider,clerkToken:c.value},w=await T.post("/webapi/users/clerk/sync",l);if(w.data.success)await z().setUserData({...w.data.user,authProvider:"clerk",sessionToken:w.data.sessionToken}),console.log("Clerk Store: 用户数据同步成功"),I.success("登录成功，欢迎回来！");else throw new Error(w.data.message||"用户数据同步失败")}catch(l){throw console.error("Clerk Store: 用户数据同步失败",l),l.code==="NETWORK_ERROR"?I.error("网络连接错误，请稍后重试"):I.error("用户数据同步失败，请联系管理员"),l}}async function fe(){if(!s.value||!a.value)return null;try{return await a.value.getToken()}catch(l){return console.error("Clerk Store: 获取 Token 失败",l),null}}async function me(){try{a.value=(u==null?void 0:u.session)||null,await F()}catch(l){console.error("Clerk Store: 更新会话信息失败",l)}}async function F(){try{a.value&&(c.value=await a.value.getToken())}catch(l){console.error("Clerk Store: 更新 Token 失败",l),c.value=null}}function te(){s.value=!1,n.value=null,a.value=null,c.value=null,h.value=null}function ge(l){return!l||!l.externalAccounts||l.externalAccounts.length===0?"email":l.externalAccounts[0].provider||"unknown"}function pe(l){const w=(l==null?void 0:l.code)||(l==null?void 0:l.type)||"clerk_error_generic";return re[w]||re.clerk_error_generic}function ve(){p.value=null}return{isClerkReady:S(t),isClerkLoading:S(e),isAuthenticated:S(s),isSigningIn:S(o),isSigningOut:S(r),currentUser:d,hasValidSession:_,authProviderInfo:G,availableProviders:S(m),lastError:S(p),errorCount:S(i),initializeClerk:A,signInWithProvider:ue,handleOAuthCallback:de,signOut:he,syncWithUserStore:W,getClerkToken:fe,clearError:ve}}),je=()=>y(()=>import("./LandingView-CvYwC1pl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),Ge=()=>y(()=>import("./DocsView-BQ7Lwi-K.js"),__vite__mapDeps([8,1,2,3,4,5,6,9])),We=()=>y(()=>import("./LoginView-yfkgcDte.js"),__vite__mapDeps([10,2,3,1,4,5,6,11])),Fe=()=>y(()=>import("./UserLoginView-LkOuC970.js"),__vite__mapDeps([12,2,3,1,4,5,6,11])),Je=()=>y(()=>import("./UserLoginSocialView-D4ZhnGSj.js"),__vite__mapDeps([13,2,3,1,4,5,6,14])),Qe=()=>y(()=>import("./SSOCallbackView-DHlwKjku.js"),__vite__mapDeps([15,2,3,1,4,5,6,16])),Xe=()=>y(()=>import("./UserDashboardView-CJETLDCK.js"),__vite__mapDeps([17,2,3,1,4,18,19,20,5,6,21,11])),Ye=()=>y(()=>import("./UserManagementView-DE6yizGJ.js"),__vite__mapDeps([22,2,3,18,19,5,6,11])),L=()=>y(()=>import("./MainLayout-6akrNuT5.js"),__vite__mapDeps([23,2,3,24,25,1,4,5,6,26])),Ze=()=>y(()=>import("./DashboardView-vsarS237.js"),__vite__mapDeps([27,5,2,3,6,28,29])),et=()=>y(()=>import("./ApiKeysView-7cAMfAOo.js"),__vite__mapDeps([30,5,2,3,6,31,32,33,34])),tt=()=>y(()=>import("./AccountsView-D66nPHej.js"),__vite__mapDeps([35,5,2,3,6,18,19,28,32,33,36])),st=()=>y(()=>import("./TutorialView-mdgdeBR0.js"),__vite__mapDeps([20,2,3,5,6,21])),rt=()=>y(()=>import("./SettingsView-C8r1XEYu.js"),__vite__mapDeps([37,2,3,5,6,38])),ot=()=>y(()=>import("./ApiStatsView-DoOtuaDP.js"),__vite__mapDeps([39,2,3,24,25,1,4,31,20,5,6,21,40])),at=[{path:"/",name:"Landing",component:je,meta:{requiresAuth:!1}},{path:"/login",name:"Login",component:We,meta:{requiresAuth:!1}},{path:"/admin-login",redirect:"/login"},{path:"/user-login",name:"UserLogin",component:Fe,meta:{requiresAuth:!1,userAuth:!0}},{path:"/user-login-social",name:"UserLoginSocial",component:Je,meta:{requiresAuth:!1,clerkAuth:!0}},{path:"/sso-callback",name:"SSOCallback",component:Qe,meta:{requiresAuth:!1,ssoCallback:!0}},{path:"/user-dashboard",name:"UserDashboard",component:Xe,meta:{requiresUserAuth:!0}},{path:"/docs",name:"Docs",component:Ge,meta:{requiresAuth:!1}},{path:"/api-stats",name:"ApiStats",component:ot,meta:{requiresAuth:!1}},{path:"/dashboard",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:Ze}]},{path:"/api-keys",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"ApiKeys",component:et}]},{path:"/accounts",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"Accounts",component:tt}]},{path:"/tutorial",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"Tutorial",component:st}]},{path:"/settings",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"Settings",component:rt}]},{path:"/user-management",component:L,meta:{requiresAuth:!0},children:[{path:"",name:"UserManagement",component:Ye}]},{path:"/:pathMatch(.*)*",redirect:"/"}],B=we({history:Ae(X.basePath),routes:at});B.beforeEach(async(t,e,s)=>{const o=ce(),r=z(),n=Be();if(console.log("路由导航:",{to:t.path,from:e.path,fullPath:t.fullPath,requiresAuth:t.meta.requiresAuth,requiresUserAuth:t.meta.requiresUserAuth,clerkAuth:t.meta.clerkAuth,ssoCallback:t.meta.ssoCallback,isAuthenticated:o.isAuthenticated,isUserAuthenticated:r.isAuthenticated,isClerkAuthenticated:n.isAuthenticated}),t.path===e.path&&t.fullPath===e.fullPath||t.meta.ssoCallback)return s();if(t.meta.requiresUserAuth){if(!r.isAuthenticated)try{if(!await r.checkAuth())return s("/user-login")}catch(a){if(a.message&&a.message.includes("disabled")){const{showToast:c}=await y(async()=>{const{showToast:m}=await Promise.resolve().then(()=>qe);return{showToast:m}},void 0);c(a.message,"error")}return s("/user-login")}return s()}t.path==="/"||t.path==="/docs"||t.path==="/api-stats"||t.path.startsWith("/api-stats")?s():t.path==="/user-login"?r.isAuthenticated?s("/user-dashboard"):s():t.path==="/user-login-social"?r.isAuthenticated?s("/user-dashboard"):!n.isClerkReady&&!n.isClerkLoading?(console.warn("Clerk 尚未初始化，重定向到传统登录页面"),s("/user-login")):s():t.meta.requiresAuth&&!o.isAuthenticated?s("/login"):t.path==="/login"&&o.isAuthenticated?s("/dashboard"):s()});const ce=j("auth",()=>{const t=f(!1),e=f(localStorage.getItem("authToken")||""),s=f(""),o=f(""),r=f(!1),n=f({siteName:"Claude Relay Service",siteIcon:"",siteIconData:"",faviconData:""}),a=f(!0),c=E(()=>!!e.value&&t.value),m=E(()=>e.value),h=E(()=>({username:s.value}));async function p(d){r.value=!0,o.value="";try{const _=await q.post("/web/auth/login",d);_.success?(e.value=_.token,s.value=_.username||d.username,t.value=!0,localStorage.setItem("authToken",_.token),await B.push("/dashboard")):o.value=_.message||"登录失败"}catch(_){o.value=_.message||"登录失败，请检查用户名和密码"}finally{r.value=!1}}function i(){t.value=!1,e.value="",s.value="",localStorage.removeItem("authToken"),B.push("/login")}function u(){e.value&&(t.value=!0,g())}async function g(){try{const d=await q.get("/web/auth/user");d.success&&d.user&&(s.value=d.user.username),(await q.get("/admin/dashboard")).success||i()}catch{i()}}async function A(){a.value=!0;try{const d=await q.get("/admin/oem-settings");if(d.success&&d.data){if(n.value={...n.value,...d.data},d.data.siteIconData||d.data.siteIcon){const _=document.querySelector("link[rel*='icon']")||document.createElement("link");_.type="image/x-icon",_.rel="shortcut icon",_.href=d.data.siteIconData||d.data.siteIcon,document.getElementsByTagName("head")[0].appendChild(_)}d.data.siteName&&(document.title=`${d.data.siteName} - 管理后台`)}}catch(d){console.error("加载OEM设置失败:",d)}finally{a.value=!1}}return{isLoggedIn:t,authToken:e,username:s,loginError:o,loginLoading:r,oemSettings:n,oemLoading:a,isAuthenticated:c,token:m,user:h,login:p,logout:i,checkAuth:u,loadOemSettings:A}}),k={LIGHT:"light",DARK:"dark",AUTO:"auto"},nt=j("theme",()=>{const t=f(k.AUTO),e=f(!1),s=E(()=>t.value===k.DARK?!0:t.value===k.LIGHT?!1:e.value),o=E(()=>s.value?k.DARK:k.LIGHT),r=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)");e.value=i.matches;const u=localStorage.getItem("themeMode");u&&Object.values(k).includes(u)?t.value=u:t.value=k.AUTO,n(),m()},n=()=>{const i=document.documentElement;s.value?i.classList.add("dark"):i.classList.remove("dark")},a=i=>{Object.values(k).includes(i)&&(t.value=i)},c=()=>{const i=[k.LIGHT,k.DARK,k.AUTO],g=(i.indexOf(t.value)+1)%i.length;t.value=i[g]};D(t,i=>{localStorage.setItem("themeMode",i),n()}),D(e,()=>{t.value===k.AUTO&&n()});const m=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)"),u=g=>{e.value=g.matches};return e.value=i.matches,i.addEventListener("change",u),()=>{i.removeEventListener("change",u)}};return{themeMode:t,isDarkMode:s,currentTheme:o,systemPrefersDark:e,ThemeMode:k,initTheme:r,setThemeMode:a,cycleThemeMode:c,watchSystemTheme:m,toggleTheme:()=>{c()},setTheme:i=>{i==="dark"?a(k.DARK):i==="light"&&a(k.LIGHT)}}}),Z=(t,e)=>{const s=t.__vccOpts||t;for(const[o,r]of e)s[o]=r;return s},it={class:"toast-container"},lt=["onClick"],ct={class:"toast-content"},ut={class:"toast-icon"},dt={class:"toast-body"},ht={key:0,class:"toast-title"},ft={class:"toast-message"},mt=["onClick"],gt={__name:"ToastNotification",setup(t,{expose:e}){const s=f([]);let o=0;const r=h=>{const p={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return p[h]||p.info},n=(h,p="info",i=null,u=5e3)=>{const g=++o,A={id:g,message:h,type:p,title:i,duration:u,isVisible:!1};return s.value.push(A),setTimeout(()=>{A.isVisible=!0},10),u>0&&setTimeout(()=>{a(g)},u),g},a=h=>{const p=s.value.findIndex(i=>i.id===h);if(p>-1){const i=s.value[p];i.isVisible=!1,setTimeout(()=>{const u=s.value.findIndex(g=>g.id===h);u>-1&&s.value.splice(u,1)},300)}},c=()=>{s.value.forEach(h=>{h.isVisible=!1}),setTimeout(()=>{s.value.length=0},300)},m=(h,p="info",i=null,u=5e3)=>n(h,p,i,u);return Q(()=>{window.showToast=m}),oe(()=>{window.showToast===m&&delete window.showToast}),e({showToast:m,removeToast:a,clearAllToasts:c}),(h,p)=>(b(),ae(ne,{to:"body"},[v("div",it,[(b(!0),x(be,null,Te(s.value,i=>(b(),x("div",{key:i.id,class:J(["toast",`toast-${i.type}`,i.isVisible?"toast-show":"toast-hide"]),onClick:u=>a(i.id)},[v("div",ct,[v("div",ut,[v("i",{class:J(r(i.type))},null,2)]),v("div",dt,[i.title?(b(),x("div",ht,O(i.title),1)):H("",!0),v("div",ft,O(i.message),1)]),v("button",{class:"toast-close",onClick:ie(u=>a(i.id),["stop"])},p[0]||(p[0]=[v("i",{class:"fas fa-times"},null,-1)]),8,mt)]),i.duration>0?(b(),x("div",{key:0,class:"toast-progress",style:Se({animationDuration:`${i.duration}ms`})},null,4)):H("",!0)],10,lt))),128))])]))}},pt=Z(gt,[["__scopeId","data-v-c8b24ff5"]]),vt={class:"modal-content mx-auto w-full max-w-md p-6"},_t={class:"mb-6 flex items-start gap-4"},yt={class:"flex-1"},kt={class:"mb-2 text-lg font-semibold text-gray-900 dark:text-white"},wt={class:"whitespace-pre-line leading-relaxed text-gray-700 dark:text-gray-400"},At={class:"flex items-center justify-end gap-3"},Tt=["disabled"],bt=["disabled"],St={key:0,class:"loading-spinner mr-2"},Et={__name:"ConfirmDialog",setup(t,{expose:e}){const s=f(!1),o=f(!1),r=f(""),n=f(""),a=f("确认"),c=f("取消");let m=null;const h=(g,A,d="确认",_="取消")=>new Promise(G=>{r.value=g,n.value=A,a.value=d,c.value=_,s.value=!0,o.value=!1,m=G}),p=()=>{o.value||(o.value=!0,setTimeout(()=>{s.value=!1,o.value=!1,m&&(m(!0),m=null)},200))},i=()=>{o.value||(s.value=!1,m&&(m(!1),m=null))},u=g=>{s.value&&(g.key==="Escape"?i():g.key==="Enter"&&!g.shiftKey&&!g.ctrlKey&&!g.altKey&&p())};return Q(()=>{window.showConfirm=h,document.addEventListener("keydown",u)}),oe(()=>{window.showConfirm===h&&delete window.showConfirm,document.removeEventListener("keydown",u)}),e({showConfirm:h}),(g,A)=>(b(),ae(ne,{to:"body"},[K(Ce,{appear:"",name:"modal"},{default:Ee(()=>[s.value?(b(),x("div",{key:0,class:"modal fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:ie(i,["self"])},[v("div",vt,[v("div",_t,[A[0]||(A[0]=v("div",{class:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-amber-600"},[v("i",{class:"fas fa-exclamation-triangle text-lg text-white"})],-1)),v("div",yt,[v("h3",kt,O(r.value),1),v("div",wt,O(n.value),1)])]),v("div",At,[v("button",{class:"btn bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:o.value,onClick:i},O(c.value),9,Tt),v("button",{class:J(["btn btn-warning px-6 py-3",{"cursor-not-allowed opacity-50":o.value}]),disabled:o.value,onClick:p},[o.value?(b(),x("div",St)):H("",!0),xe(" "+O(a.value),1)],10,bt)])])])):H("",!0)]),_:1})]))}},Ct=Z(Et,[["__scopeId","data-v-6b3390a6"]]),xt={id:"app"},It={__name:"App",setup(t){const e=ce(),s=nt(),o=f(),r=f();return Q(()=>{s.initTheme(),s.watchSystemTheme(),e.checkAuth(),e.loadOemSettings()}),(n,a)=>{const c=Ie("router-view");return b(),x("div",xt,[K(c),K(pt,{ref_key:"toastRef",ref:o},null,512),K(Ct,{ref_key:"confirmRef",ref:r},null,512)])}}},Pt=Z(It,[["__scopeId","data-v-dab04b7e"]]),V=Pe(Pt),Lt=Le();V.use(Lt);V.use(B);V.use(Ue,{locale:De});ze()?(V.use(Oe,{publishableKey:M.publishableKey,localization:M.localization,appearance:M.appearance,routing:M.routing}),console.log("Clerk: 已成功初始化用户认证系统")):console.warn("Clerk: 配置验证失败，社交登录功能将不可用");const Ot=z();Ot.setupAxiosInterceptors();V.mount("#app");export{Z as _,ce as a,z as b,Be as c,q as d,le as s,nt as u};
